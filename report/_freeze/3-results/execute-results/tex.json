{
  "hash": "44f6e1935ee19b5e6135c6a47b012ec8",
  "result": {
    "markdown": "---\nexecute:\n  freeze: true\ntitle: Results\n---\n\n\n\n\n\n\n<!--\n\nAnalysis of the results with graphics like bargraphs and boxplots has been made. Statistical methods have been employed to compare different results. AUCs have been obtained. Minimal verification.\n+ Attention has been paid to the distribution of the data. Verification has been carried out. Attention is paid to overfitting.\n+ Results have been analysed with proper statistics. Model assumptions of statistical methods are verified or methods that do not make assumptions were employed for non-Gaussian data. Checks were made to avoid hidden overfitting.\n+ Best approach for obtaining significant results was taken while refraining from p-value hacking.\n\n -->\n\n\n### Evaluation of methods\n\n#### Regression {#sec-res-reg}\n\nThe best model uses only a single time-series lag, as well as moving averages and difference features. Metrics for the OLS and the regularized regression models are shown in @tbl-reg-hypopt. Even though the bias is minimized, it is still substantial at around -14 articles within a timespan of one week. (This is only for time-series splits; the bias for conventional shuffled cross-validation splits is very close to 0 for all models.) A regression table with coefficients is appended in @sec-app1-reg.\n\n| Model          | Hyp. opt. obj. | RMSE          | Bias         |\n| -------------- | -------------- | ------------- | ------------ |\n| OLS            | min RMSE       | 110.6 ± 24.2  | -18.8 ± 10.4 |\n| OLS            | min bias       | 130.9 ± 21.5  | -14.3 ± 10.1 |\n| BayesianRidge  | min bias       | 119.7 ± 23.4  | -3.85 ± 15.2 |\n| LassoLarsIC    | min bias       | 118.9 ± 24.5  | -2.89 ± 15.7 |\n\n: Bias (mean error) and root mean squared error (RMSE) as a measure for variance for the best models that result from hyperparameter optimization. {#tbl-reg-hypopt}\n\n\n\n\n#### Instrumental variables\n\n\\begingroup\n\\scriptsize\\selectfont\n\n::: {.cell execution_count=3}\n\n::: {#fig-iv-wald .cell-output .cell-output-display execution_count=3}\n```{=tex}\n\\begin{tabular}{lrrr}\n\\toprule\n{} &  corr\\_w &  corr\\_y &      wald \\\\\n\\midrule\nweather\\_tavg                &  0.0202 &  0.0375 &    672.74 \\\\\nweather\\_tmin                &  0.0292 &  0.0651 &    808.17 \\\\\nweather\\_tmax                &  0.0132 &  0.0238 &    650.41 \\\\\nweather\\_prcp                &  0.0076 &  0.0174 &    831.90 \\\\\nweather\\_snow                & -0.0167 & -0.0588 &   1274.29 \\\\\nweather\\_wspd                & -0.0190 & -0.1192 &   2271.44 \\\\\nweather\\_wpgt                & -0.0139 & -0.1043 &   2715.87 \\\\\nweather\\_pres                & -0.0089 &  0.0195 &   -792.63 \\\\\nweather\\_tsun                & -0.0011 & -0.0402 &  12802.26 \\\\\ncovid\\_retail\\_and\\_recreation &  0.0376 &  0.2006 &   1932.76 \\\\\ncovid\\_grocery\\_and\\_pharmacy  &  0.0158 &  0.2205 &   5072.44 \\\\\ncovid\\_residential           & -0.0500 & -0.2058 &   1493.50 \\\\\ncovid\\_transit\\_stations      &  0.0380 &  0.2163 &   2065.30 \\\\\ncovid\\_parks                 &  0.0266 &  0.0837 &   1141.85 \\\\\ncovid\\_workplaces            &  0.0475 &  0.2055 &   1567.75 \\\\\ncovid\\_stringency\\_index      & -0.0191 & -0.1920 &   3642.73 \\\\\n\\bottomrule\n\\end{tabular}\n```\n\nCorrelations between the instruments and the treatment (corr_w) and between the instruments and the outcome (corr_y), and Wald estimator results.\n:::\n:::\n\n\n\\endgroup\n\nCorrelations and Wald estimator results of the original variable are shown in @fig-iv-wald. Note that the Wald estimator is not valid for weak instruments.\n\nAutomatically binarizing the variables based on an optimally chosen threshold does not generally increase the covariances, and decreases them slightly in most cases. This is also true for precipiation: The optimal threshold for maximizing the covariance with protest occurrence is at prcp > 0, which is consistent with the choice in most related work (see @sec-lit-causal), but the binarization does not change the covariance much. (TODO: give number.)\n\n\\begingroup\n\\scriptsize\\selectfont\n\n::: {.cell execution_count=4}\n\n::: {#fig-iv-basic .cell-output .cell-output-display execution_count=4}\n```{=tex}\n\\begin{tabular}{lrrrrr}\n\\toprule\n{} &   coef\\_w &       p &    p\\_bh &    p\\_by &  fstat \\\\\n\\midrule\ncovid\\_parks                 &  0.01839 &  0.0036 &  0.0168 &  0.0902 &   9.96 \\\\\ncovid\\_grocery\\_and\\_pharmacy  & -0.01664 &  0.0044 &  0.0187 &  0.1002 &   3.50 \\\\\ncovid\\_workplaces            &  0.02328 &  0.0051 &  0.0209 &  0.1124 &  31.86 \\\\\nweather\\_wspd                & -0.00867 &  0.0811 &  0.2212 &  1.0000 &   5.10 \\\\\nweather\\_pres                & -0.00385 &  0.1100 &  0.2809 &  1.0000 &   1.12 \\\\\nweather\\_wpgt                &  0.00354 &  0.4623 &  0.7705 &  1.0000 &   2.73 \\\\\ncovid\\_stringency\\_index      & -0.00382 &  0.5435 &  0.8152 &  1.0000 &   5.14 \\\\\nweather\\_tmin                &  0.00802 &  0.5582 &  0.8270 &  1.0000 &  12.01 \\\\\ncovid\\_transit\\_stations      & -0.00670 &  0.5755 &  0.8321 &  1.0000 &  20.34 \\\\\nweather\\_tsun                &  0.00204 &  0.6046 &  0.8436 &  1.0000 &   0.02 \\\\\nweather\\_tmax                & -0.00770 &  0.6970 &  0.9191 &  1.0000 &   2.47 \\\\\ncovid\\_retail\\_and\\_recreation & -0.00288 &  0.7506 &  0.9306 &  1.0000 &  19.95 \\\\\nweather\\_tavg                & -0.00615 &  0.8321 &  0.9510 &  1.0000 &   5.76 \\\\\ncovid\\_residential           &  0.00099 &  0.9450 &  0.9807 &  1.0000 &  35.22 \\\\\nweather\\_snow                & -0.00005 &  0.9829 &  0.9911 &  1.0000 &   3.93 \\\\\nweather\\_prcp                &  0.00002 &  0.9941 &  0.9941 &  1.0000 &   0.81 \\\\\n\\bottomrule\n\\end{tabular}\n```\n\nFirst-stage impact of the original instruments. Regression coefficients and p-values for the impact of the standardized instruments on the treatment, controlling for known confounders. Results are sorted by original p-values and adjusted p-values (p_bh = Benjamini-Hochberg, p_by=Benjamini-Yekutieli) and first-stage f-statistics for using each variable as an instrument on its own are displayed.\n:::\n:::\n\n\n\\endgroup\n\n\\begingroup\n\\scriptsize\\selectfont\n\n::: {.cell execution_count=5}\n\n::: {#fig-iv-deseason .cell-output .cell-output-display execution_count=5}\n```{=tex}\n\\begin{tabular}{lrrrrr}\n\\toprule\n{} &   coef\\_w &       p &    p\\_bh &    p\\_by &  fstat \\\\\n\\midrule\ncovid\\_workplaces\\_seasonal           &  0.06174 &  0.0006 &  0.0036 &  0.0200 &   8.58 \\\\\ncovid\\_stringency\\_index\\_seasonal     & -0.03709 &  0.0018 &  0.0104 &  0.0572 &   0.06 \\\\\ncovid\\_stringency\\_index\\_resid        &  0.00872 &  0.0073 &  0.0331 &  0.1816 &   2.56 \\\\\ncovid\\_transit\\_stations\\_seasonal     & -0.06763 &  0.0078 &  0.0343 &  0.1883 &   5.19 \\\\\ncovid\\_grocery\\_and\\_pharmacy\\_resid    & -0.01219 &  0.0081 &  0.0343 &  0.1883 &   0.77 \\\\\ncovid\\_parks\\_seasonal                &  0.05477 &  0.0102 &  0.0409 &  0.2248 &  21.75 \\\\\nweather\\_wspd\\_resid                  & -0.01074 &  0.0239 &  0.0774 &  0.4251 &   1.62 \\\\\nweather\\_pres\\_resid                  & -0.00420 &  0.0886 &  0.2511 &  1.0000 &   1.66 \\\\\ncovid\\_residential\\_resid             & -0.01348 &  0.1220 &  0.3131 &  1.0000 &  19.31 \\\\\ncovid\\_grocery\\_and\\_pharmacy\\_seasonal & -0.02819 &  0.1363 &  0.3432 &  1.0000 &   4.43 \\\\\n\\bottomrule\n\\end{tabular}\n```\n\nFirst-stage impact of the seasonal and residual parts of the instruments. Regression coefficients and p-values for the impact of the standardized instruments on the treatment, controlling for known confounders. Results are sorted by original p-values and adjusted p-values (p_bh = Benjamini-Hochberg, p_by=Benjamini-Yekutieli) and first-stage f-statistics for using each variable as an instrument on its own are displayed. Only the 10 most significant variables are displayed.\n:::\n:::\n\n\n\\endgroup\n\n\\begingroup\n\\footnotesize\\selectfont\n\n::: {.cell execution_count=6}\n\n::: {#fig-iv-deseason-pc .cell-output .cell-output-display execution_count=6}\n```{=tex}\n\\begin{tabular}{lrrrrr}\n\\toprule\n{} &   coef\\_w &       p &    p\\_bh &    p\\_by &  fstat \\\\\n\\midrule\npc\\_seasonal\\_12 & -0.01009 &  0.0000 &  0.0002 &  0.0009 &  69.37 \\\\\npc\\_resid\\_9     & -0.00730 &  0.0005 &  0.0029 &  0.0162 &  28.31 \\\\\npc\\_seasonal\\_0  & -0.00598 &  0.0122 &  0.0520 &  0.2857 &  17.70 \\\\\npc\\_seasonal\\_9  & -0.00566 &  0.0291 &  0.1016 &  0.5583 &  16.76 \\\\\npc\\_seasonal\\_10 & -0.00452 &  0.0455 &  0.1477 &  0.8114 &   2.18 \\\\\npc\\_resid\\_8     & -0.00408 &  0.0504 &  0.1594 &  0.8757 &   2.21 \\\\\npc\\_seasonal\\_1  & -0.00434 &  0.0634 &  0.1920 &  1.0000 &   7.46 \\\\\npc\\_resid\\_11    &  0.00368 &  0.0673 &  0.1947 &  1.0000 &   2.16 \\\\\npc\\_seasonal\\_6  &  0.00450 &  0.0772 &  0.2187 &  1.0000 &   7.13 \\\\\npc\\_resid\\_7     &  0.00281 &  0.1618 &  0.4040 &  1.0000 &   0.23 \\\\\n\\bottomrule\n\\end{tabular}\n```\n\nFirst-stage impact of principal components calculated separately for the seasonal and residual parts of the instruments. Regression coefficients and p-values for the impact of the standardized instruments on the treatment, controlling for known confounders. Results are sorted by original p-values and adjusted p-values (p_bh = Benjamini-Hochberg, p_by=Benjamini-Yekutieli) and first-stage f-statistics for using each variable as an instrument on its own are displayed. Only the 10 most significant variables are displayed.\n:::\n:::\n\n\n\\endgroup\n\n\n\nMultiple steps are shown for the impact of the instruments on the treatment while controlling for known confounders and other instruments:\n\n1. @fig-iv-basic shows the impact of the original instruments. Three of the covid variables are relatively significant, the weather variables less so, with _wind speed_ being most significant and precipitation least significant.\n2. @fig-iv-deseason shows the impact for the variables after splitting them into seasonal and residual components. The most significant variables are seasonal ones derived from covid variables. Of the residuals, the _stringency index_, the movement data for \"grocery and pharmacy\", and _wind speed_ are most significant.\n3. @fig-iv-deseason-pc shows the principal components for the seasonal and residual variables from the previous step. The top two variables are much more significant than without PC, and one of them is a residual variable. The meaning of the three most significant reidual variables is shown in @fig-iv-pc-vis. According to the \"rule of thumb\" (@InstrumentalVariablesEstimation2023) the threshold for weak instruments is around f=10, so pc_resid_9 would be a strong instrument but the other ones would all be weak.\n\nPlacebo tests for the first stage are given in @fig-iv-1-placebo. The instrument has a significant impact on protest occurrence for a few days around the date where the instrument was measured. For days that are further away there is less impact, but not exactly zero. Placebo tests for the second stage are shown together with the other methods in @sec-res-placebo.\n\n::: {.cell execution_count=8}\n\n::: {.cell-output .cell-output-display}\n![First stage placebo tests for using the principal component pc_resid_9 to instrument protest occurrence. Values for the instrument from after the protest date are used. These values cannot have an impact on protest occurrence if the instrument is valid.](3-results_files/figure-pdf/fig-iv-1-placebo-output-1.svg){#fig-iv-1-placebo}\n:::\n:::\n\n\n#### Synthetic control\n\n@fig-synth-hyperopt shows how the length of the pre-treatment period influences the bias of the causal estimate. Bias is most reduced at n=180, with a bias (mean error) of -0.330±1.13, and an RMSE of 65.8±2.40.\n\n::: {.cell execution_count=9}\n\n::: {.cell-output .cell-output-display}\n![Hyperparameter optimization: Influence of the pre-period length on bias (mean error).](3-results_files/figure-pdf/fig-synth-hyperopt-output-1.svg){#fig-synth-hyperopt}\n:::\n:::\n\n\n@fig-sc-long shows the fit for the optimized unbiased model (specifically: unbiased for estimating the -day cumulative coverage).\n\n::: {.cell execution_count=10}\n\n::: {.cell-output .cell-output-display}\n![Synthetic control fit around the treatment for a pre-treatment period of n=180. Values are aggregates from synthetic controls for all protest events. Weekly patterns are due to regularities in protest event timing (Fridays for Future) and weekly cycles in general newspaper coverage.](3-results_files/figure-pdf/fig-sc-long-output-1.svg){#fig-sc-long}\n:::\n:::\n\n\n@fig-sc-short shows the fit for a shorter pre-treatment period and with better pre-treatment fit.\n\n::: {.cell layout-nrow='2' execution_count=11}\n\n::: {.cell-output .cell-output-display}\n![Synthetic control fit around the treatment for a pre-treatment period of n=22. Values are aggregates from synthetic controls for all protest events. Weekly patterns are due to regularities in protest event timing (Fridays for Future) and weekly cycles in general newspaper coverage.](3-results_files/figure-pdf/fig-sc-short-output-1.svg){#fig-sc-short}\n:::\n:::\n\n\n@fig-sc-longterm gives an impression of the long-term impact estimate. Rolling averages are used for preprocessing, so the absolute impacts cannot directly be retrieved.\n\n::: {.cell execution_count=12}\n\n::: {.cell-output .cell-output-display}\n![Synthetic control with pre-treatment period of two years and longterm effects for half a year. Outcomes have been preprocessed with weekly rolling averages. No bias checks have been made for this model.](3-results_files/figure-pdf/fig-sc-longterm-output-1.svg){#fig-sc-longterm}\n:::\n:::\n\n\n#### Propensity scores\n\nHyperparameter optimization shows that the best model is a logistic regression model without balanced class weights, using all available features (moving averages, differences, and log-scaled protest sizes), 4 days of time-series lags, and z-score standardization of all feature variables.\n\nThe baseline value for the F1 score can be calculated by setting all predictions positive. This results in F1=0.118 for my dataset.\n\nThe best logistic regression model achieves a 5-fold time-series cross-validated score of F1=0.233±0.044, while a similar model with balanced class weights achieves F1=0.213±0.017.\n\nBrief experiments with doubly robust estimation show that other than expected it gives estimates that are multiple orders of magnitudes higher than those of regression or inverse propensity weighting; it estimates chaotic time series; and it is overly sensitive to the hyperparameters that create the time series features (number of lags, inclusion of moving averages, etc.), much more than regression or IPW. I do not further investigate the problem and exclude the method from the analysis.\n\n### Placebo tests {#sec-res-placebo}\n\n@fig-placebo-outcome shows placebo tests for the outcome for all models. Further placebo tests concern the treatments: For @fig-placebo-treatment-regional, the treatments are randomized within each region, while for @fig-placebo-treatment-global they are randomized across region (see @sec-meth-placebo).\n\n::: {.cell .column-page execution_count=13}\n\n::: {.cell-output .cell-output-display}\n![Placebo tests for the outcome. The protests event date is at x=0. To the right of it are impact estimates for subsequent days, where it is possible that there actually is a causal impact. To the left of it are the days prior to the event data, where a causal impact is not possible. Pay attention to the differences in the y-axis scale.](3-results_files/figure-pdf/fig-placebo-outcome-output-1.svg){#fig-placebo-outcome}\n:::\n:::\n\n\n::: {.cell .column-page execution_count=14}\n\n::: {.cell-output .cell-output-display}\n![Placebo tests for the treatment, where treatments are randomized but the protest day proportions among regions are not, potentially causing some bias. Pay attention to the differences in the y-axis scale.](3-results_files/figure-pdf/fig-placebo-treatment-regional-output-1.svg){#fig-placebo-treatment-regional}\n:::\n:::\n\n\n::: {.cell .column-page execution_count=15}\n\n::: {.cell-output .cell-output-display}\n![Placebo tests for the treatment, with completely randomized treatments across regions. Pay attention to the differences in the y-axis scale.](3-results_files/figure-pdf/fig-placebo-treatment-global-output-1.svg){#fig-placebo-treatment-global}\n:::\n:::\n\n\n### Causal impact estimates {#sec-res-est}\n\n@fig-impact-ts and @fig-impact-ts-cum show time series of the absolute and cumulative causal impact estimates, for protest-related and non-protest-related media coverage and for all causal methods. The order of magnitude of the causal effects differs substantially between some of the methods.\n\n::: {.cell .column-page execution_count=16}\n\n::: {.cell-output .cell-output-display}\n![Causal impact estimates by method and newspaper coverage dimension. The protest day is at x=0. Pay attention to the differences in the y-axis scale.](3-results_files/figure-pdf/fig-impact-ts-output-1.svg){#fig-impact-ts}\n:::\n:::\n\n\n::: {.cell .column-page execution_count=17}\n\n::: {.cell-output .cell-output-display}\n![Pay attention to the differences in the y-axis scale.](3-results_files/figure-pdf/fig-impact-ts-cum-output-1.svg){#fig-impact-ts-cum}\n:::\n:::\n\n\n@fig-impact-dims summarizes the 7-day cumulative impacts by coverage dimension and includes the impact for three specific sub-topics (see @sec-data-discourse).\n\n::: {.cell .column-page execution_count=18}\n\n::: {.cell-output .cell-output-display execution_count=18}\n![7-day cumulative causal impact estimates by method. Error bars are 95% confidence intervals. Pay attention to differing y-axis scaling.](3-results_files/figure-pdf/fig-impact-dims-output-1.svg){#fig-impact-dims}\n:::\n:::\n\n\n@fig-impact-medium differentiates between the impact on online newspapers and on print newspapers, only for the synthetic control method. @fig-impact-groups-7 break down the 7-day cumulative impact for the different protest groups, as estimated by the synthetic control method.\n\n::: {.cell .column-page execution_count=19}\n\n::: {.cell-output .cell-output-display}\n![Causal impact estimates for online vs print newspapers, as estimated by the synthetic control method. The protest day is at x=0.](3-results_files/figure-pdf/fig-impact-medium-output-1.svg){#fig-impact-medium}\n:::\n:::\n\n\n::: {.cell .column-page execution_count=20}\n\n::: {.cell-output .cell-output-display execution_count=20}\n![7-day cumulative causal impact estimates by protest group, as estimated by the synthetic control method. Error bars are 95% confidence intervals. Pay attention to differing y-axis scaling.](3-results_files/figure-pdf/fig-impact-groups-7-output-1.svg){#fig-impact-groups-7}\n:::\n:::\n\n\nTo do: impact by dataset.\n\nGPReg:\n\n::: {.cell .column-page execution_count=21}\n\n::: {.cell-output .cell-output-display}\n![Causal impact estimates by method and newspaper coverage dimension. The protest day is at x=0. Pay attention to the differences in the y-axis scale.](3-results_files/figure-pdf/fig-impact-ts-gpreg-output-1.svg){#fig-impact-ts-gpreg}\n:::\n:::\n\n\n::: {.cell .column-page execution_count=22}\n\n::: {.cell-output .cell-output-display execution_count=22}\n![7-day cumulative causal impact estimates by protest group, as estimated by the synthetic control method. Error bars are 95% confidence intervals. Pay attention to differing y-axis scaling.](3-results_files/figure-pdf/fig-impact-groups-sources-output-1.svg){#fig-impact-groups-sources}\n:::\n:::\n\n\nGPRep:\n\n1401 overall\n1353 with nonnull region and nonnull date\n\ndates without control regions:\n- 2021-03-19\n- 2021-09-24\n- 2022-03-25\n\n::: {.cell .column-page execution_count=23}\n\n::: {.cell-output .cell-output-display}\n![Causal impact estimates by method and newspaper coverage dimension. The protest day is at x=0. Pay attention to the differences in the y-axis scale.](3-results_files/figure-pdf/fig-impact-ts-gprep-output-1.svg){#fig-impact-ts-gprep}\n:::\n:::\n\n\n::: {.cell .column-page execution_count=24}\n\n::: {.cell-output .cell-output-display}\n![Causal impact estimates by dataset, as estimated by the synthetic control method. The protest day is at x=0.](3-results_files/figure-pdf/fig-impact-dataset-output-1.svg){#fig-impact-dataset}\n:::\n:::\n\n\n",
    "supporting": [
      "3-results_files/figure-pdf"
    ],
    "filters": []
  }
}
