## Causal analysis via synthetic control {#sec-synth}

_Factor model_ [similar to @abadieSyntheticControlMethods2010]:

$$
Y_r = \beta + \beta_X X_r + \beta_W W_r + \beta_U U + \beta_{UX}^T (X_r U^T) \beta_{XU}
$$

with m-dimensional vectors $\beta_{UX}, X_r$ and n-dimensional vectors $\beta_{XU}, U$, so their product term in the equation above is scalar.

The counterfactual:

$$
Y_r(0) = \beta + \beta_X X_r + \beta_U U + \beta_{UX}^T (X_r U^T) \beta_{XU}
$$

Assumptions:

Let $R_0 = \{r \in R|W_r=0\}$ be the set of control regions.

1. $\sum_{s \in R_0} \gamma_s = 1$
2. $E(\sum_{s \in R_0} \gamma_s X_s) = X_r$

Interpolation from other regions, $\hat Y_r(0) &= \sum_{s \in R_0} \gamma_s Y_s$ as estimator.

$$
\begin{aligned}
E(\hat Y_r(0)) &= E\left(\sum_{s \in R_0} \gamma_s Y_s\right) \\
&= E\left\{\sum_{s \in R_0} \gamma_s \left[\beta + \beta_X X_s + \beta_U U + \beta_{UX}^T (X_r U^T) \beta_{XU} \right]\right\} \\
&= \beta + \beta_U U + \beta_X E\left(\sum_{s \in R_0} \gamma_s  X_s\right) + \beta_{UX}^T \left[E\left(\sum_{s \in R_0} \gamma_s X_r \right) U^T\right] \beta_{XU} && \text{by assumption 1} \\
&= \beta + \beta_X X_r + \beta_U U + \beta_{UX}^T (X_r U^T) \beta_{XU} && \text{by assumption 2} \\
&= Y_r(0)
\end{aligned}
$$

Weights $\gamma$ can be obtained by "upside down regression" [@facurealvesCausalInferenceBrave2022, ch. 15] to estimate $E(X_r)=\gamma_1 X_1 + ... + \gamma_n X_n$ for the control regions $1...n=R_0$. In principle, we can use OLS or nonnegative least squares (NLS) for the estimation. However, this allows the model to _extrapolate_ rather than _interpolate_ between the control regions. To estimate weights that interpolate (that is, they are positive and sum up to 1), we can define a loss function $\left|X_r - \sum_{s \in R_0} \gamma_s X_s\right|$ and minimize it subject to the positivity and sum constraints on the weights, for example by using quadratic programming as minimization technique [@facurealvesCausalInferenceBrave2022, ch. 15; @abadieSyntheticControlMethods2010].

Since the available control regions vary from day to day, many regressions have to be run.^[The number of models to be estimated is asympotically exponential in the number of regions, but the number of regions is small.] The number of samples for each regression may be small, leading to a large variance for $\hat Y_r(0)$ and making systematic bias more likely.

$X_r$ may be chosen to either represent (static) fundamental data about the regions that is suspected to be predictive of treatment or outcome [@abadieSyntheticControlMethods2010]; or it can just be previous time-serious information about the outcome and other variables [@facurealvesCausalInferenceBrave2022, ch. 15].

<!-- This is location-based matching

Alternative: @MatrixProfileStumpy for time-based matching. But: would assume that confounders are time-invariant, not plausible; or that they are fully caught somehow by the time series, also not too plausible.

cite Abadie, Cunningham

### Selecting control regions based on the distance

- reverse and effect

### Selecting control regions based on sociodemographics

Variables

Methods:
- correlation
- linear regression
- PC regression
- PLS regression
- NMF regression

visualize "maps of Germany" based on first 2 components

select n_components based on cross-validation

### Selecting control regions based on high predictive quality

#### manually

#### using tf-causalimpact

### Bias from incomplete protest data

#### Difficulties with small protest events

#### Difficulties with large protest events -->
